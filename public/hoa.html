<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GDMS ‚Äî Head of Agency</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÅ</text></svg>">
  <style>
    :root {
      --gdms-blue: #1a5f7a;
      --gdms-teal: #159895;
      --gdms-accent: #57c5b6;
      --gdms-gold: #d97706;
      --gdms-green: #059669;
      --gdms-red: #dc2626;
    }
    /* Loading Screen */
    #loading-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, var(--gdms-blue), var(--gdms-teal));
      display: flex; flex-direction: column; justify-content: center;
      align-items: center; z-index: 9999; transition: opacity 0.5s ease;
    }
    .loading-spinner {
      width: 60px; height: 60px; border: 5px solid rgba(255,255,255,0.3);
      border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { color: white; font-size: 1.2rem; margin-top: 10px; }
    /* Role Badge */
    .role-badge {
      display: inline-block; padding: 3px 8px; border-radius: 12px;
      font-size: 0.75rem; font-weight: 600; margin-left: 8px;
    }
    .role-hoa { background: #28a745; color: white; }
    /* Agency Badge */
    .agency-badge {
      display: inline-block; padding: 2px 8px;
      background: #e3f2fd; color: var(--gdms-blue);
      border-radius: 10px; font-size: 0.75rem; font-weight: 500;
      margin-left: 5px;
    }
    /* Stat Card */
    .stat-card {
      background: white; border-radius: 12px; padding: 1.25rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: all 0.2s;
    }
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    /* Action Button */
    .action-btn {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; padding: 1rem; 
      background: linear-gradient(135deg, var(--gdms-blue), var(--gdms-teal));
      color: white; border: none; border-radius: 10px;
      font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s;
    }
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(26, 95, 122, 0.2);
    }
    .action-btn i { font-size: 1.5rem; margin-bottom: 0.5rem; }
    /* Status Badge */
    .status-badge {
      padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;
    }
    .status-pending { background: #fff3cd; color: #856404; }
    .status-approved { background: #d4edda; color: #155724; }
    .status-returned { background: #f8d7da; color: #721c24; }
    .status-active { background: #d4edda; color: #155724; }
    .status-inactive { background: #f8d7da; color: #721c24; }
    .status-waiting { background: #cce5ff; color: #004085; }
    .status-forwarded { background: #e8f4fd; color: #0d6efd; }
    /* Connection Status */
    #connection-status {
      position: fixed; bottom: 10px; right: 10px; padding: 8px 15px;
      border-radius: 20px; font-size: 0.8rem; z-index: 1000;
      background: #d4edda; color: #155724; border: 1px solid #c3e6cb;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex; align-items: center; gap: 8px;
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background-color: white;
      border-radius: 10px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalFadeIn 0.3s ease;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h3 {
      color: var(--gdms-blue);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6c757d;
    }
    .modal-body {
      padding: 20px;
    }
    .modal-footer {
      padding: 20px;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }
    .form-control {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--gdms-blue);
      box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    /* Table Styles */
    .table-container {
      overflow-x: auto;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    .table th {
      background-color: #f8f9fa;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
      color: #333;
      border-bottom: 1px solid #dee2e6;
      white-space: nowrap;
    }
    .table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
    }
    .table tr:hover {
      background-color: #f8f9fa;
    }
    /* Button Styles */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    .btn-primary {
      background: var(--gdms-blue);
      color: white;
    }
    .btn-primary:hover {
      background: #0d4d63;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    /* Page Transitions */
    .page {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    .page.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    /* Alert Styles */
    .alert {
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border-left: 4px solid #c3e6cb;
    }
    .alert-warning {
      background-color: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffeaa7;
    }
    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border-left: 4px solid #f5c6cb;
    }
    .alert-info {
      background-color: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #bee5eb;
    }
    /* File Upload Styles */
    .file-upload-container {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8f9fa;
    }
    .file-upload-container:hover {
      border-color: var(--gdms-blue);
      background: #f0f7ff;
    }
    .file-upload-container.dragover {
      border-color: var(--gdms-blue);
      background: #e3f2fd;
      transform: scale(1.02);
    }
    .file-preview {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .file-preview-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #ddd;
    }
    .file-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .file-preview-item .remove-file {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(220, 53, 69, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 12px;
      cursor: pointer;
    }
    /* Role-specific declaration notice */
    .role-declaration-notice {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border-left: 4px solid var(--gdms-blue);
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .role-declaration-notice h4 {
      color: var(--gdms-blue);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- AUTHENTICATION CHECK -->
  <script>
    (function() {
      // Check if user is authenticated
      const user = localStorage.getItem('gdms_user');
      const token = localStorage.getItem('gdms_token');
      
      if (!user || !token) {
        console.log('üö´ No authentication found. Redirecting to login...');
        // Clear any leftover data
        localStorage.removeItem('gdms_user');
        localStorage.removeItem('gdms_token');
        sessionStorage.removeItem('gdms_session');
        // Redirect immediately
        window.location.href = 'login.html';
        return;
      }
      
      // Parse user data
      let userData;
      try {
        userData = JSON.parse(user);
      } catch (e) {
        console.error('Error parsing user data:', e);
        window.location.href = 'login.html';
        return;
      }
      
      // Check if user is authorized for this dashboard
      const currentPage = window.location.pathname.split('/').pop();
      const userRole = userData.role;
      
      // Only hoa role should access hoa.html
      if (userRole !== 'hoa') {
        console.log(`üö´ User role ${userRole} not authorized for hoa.html`);
        console.log(`‚û°Ô∏è Redirecting to correct dashboard...`);
        
        // Redirect to correct dashboard based on role
        const redirectMap = {
          'acc-admin': 'acc-dashboard.html',
          'public-servant': 'public-official.html',
          'gda': 'gda.html',
          'hoa': 'hoa.html',
          'gac-member': 'gac.html'
        };
        
        const correctPage = redirectMap[userRole] || 'login.html';
        window.location.href = correctPage;
        return;
      }
      
      console.log(`‚úÖ User ${userData.name} (${userRole}) authorized for hoa.html`);
      
      // Store user data globally for JavaScript to use
      window.realUserData = userData;
    })();
  </script>

  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading GDMS...</div>
  </div>

  <!-- User Info Bar -->
  <div id="user-info-bar" class="bg-gray-100 px-6 py-3 border-b flex justify-between items-center" style="display: none;">
    <div class="flex items-center space-x-4">
      <div class="user-avatar w-10 h-10 rounded-full bg-gradient-to-r from-green-600 to-blue-600 flex items-center justify-center text-white font-bold" id="user-avatar">PL</div>
      <div>
        <h4 id="user-name" class="font-medium text-gray-900">Loading...</h4>
        <p class="text-sm text-gray-600">
          <span class="role-badge role-hoa">Head of Agency</span>
          <span class="agency-badge" id="user-agency">Loading...</span>
        </p>
      </div>
    </div>
    <button id="logout-button" class="px-4 py-2 bg-red-600 text-white rounded-md flex items-center gap-2 hover:bg-red-700">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>

  <!-- Header -->
  <header id="main-header" class="bg-white shadow-sm border-b" style="display: none;">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="bg-red-600 text-white p-2 rounded">
          <i class="fas fa-gift text-xl"></i>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-900">GDMS</h1>
          <p class="text-xs text-gray-500">Online Gift Declaration and Management System</p>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 rounded-full bg-gradient-to-r from-green-600 to-blue-600 flex items-center justify-center text-white text-sm font-bold" id="header-avatar">PL</div>
          <div class="text-right">
            <div class="font-medium text-gray-900" id="header-user-name">Loading...</div>
            <div class="text-xs text-gray-500" id="header-user-role">Head of Agency</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav id="main-navigation" class="bg-white border-b" style="display: none;">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex space-x-1 py-2">
        <a href="#" class="nav-tab active flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-blue-600 text-gray-900" data-page="dashboard">
          <i class="fas fa-home mr-2"></i> Dashboard
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="declare">
          <i class="fas fa-plus-circle mr-2"></i> Declare Gift
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="my-gifts">
          <i class="fas fa-gifts mr-2"></i> My Gifts
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="review">
          <i class="fas fa-gavel mr-2"></i> Review Gifts
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="register">
          <i class="fas fa-book mr-2"></i> Gift Register
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="penalties">
          <i class="fas fa-exclamation-triangle mr-2"></i> Penalties
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="knowledge">
          <i class="fas fa-info-circle mr-2"></i> Guidance
        </a>
        <a href="#" class="nav-tab flex items-center px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:bg-gray-50" data-page="users">
          <i class="fas fa-users mr-2"></i> Manage GDA/GAC
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main id="main-content" class="max-w-7xl mx-auto px-6 py-8" style="display: none;">
    <!-- DASHBOARD -->
    <div id="dashboard" class="page active">
      <div id="hoa-dashboard" class="role-dashboard">
        <div class="bg-gradient-to-r from-blue-600 to-teal-600 rounded-lg p-6 text-white mb-8">
          <h2 class="text-2xl font-bold">Head of Agency Dashboard</h2>
          <p class="opacity-90">Agency: <span id="hoa-agency-name">Anti-Corruption Commission</span></p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="stat-card">
            <p class="text-sm text-gray-500">My Declarations</p>
            <p class="text-3xl font-bold text-gray-900" id="hoa-personal-declarations">3</p>
            <div class="mt-2 text-xs text-blue-600">
              <i class="fas fa-user-tie mr-1"></i> Personal gifts declared
            </div>
          </div>
          <div class="stat-card">
            <p class="text-sm text-gray-500">Pending My Decision</p>
            <p class="text-3xl font-bold text-gray-900" id="hoa-pending-decisions">8</p>
            <div class="mt-2">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                <i class="fas fa-exclamation-circle mr-1"></i> Requires Action
              </span>
            </div>
          </div>
          <div class="stat-card">
            <p class="text-sm text-gray-500">Agency Compliance Rate</p>
            <div class="flex items-baseline mt-1">
              <p class="text-3xl font-bold text-gray-900" id="hoa-compliance-rate">92%</p>
              <span class="ml-2 text-green-600 font-medium">‚úì Good</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 mt-2">
              <div class="bg-green-500 h-3 rounded-full" id="hoa-compliance-bar" style="width: 92%"></div>
            </div>
          </div>
          <div class="stat-card">
            <p class="text-sm text-gray-500">Self-Registered Users</p>
            <p class="text-3xl font-bold text-gray-900 mt-1" id="hoa-new-users">47</p>
            <p class="text-xs text-gray-500 mt-1">Active public officials</p>
          </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow mb-8">
          <h3 class="text-lg font-bold text-gray-900 mb-4"><i class="fas fa-bolt mr-2"></i> Quick Actions</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <button class="action-btn" onclick="navigateTo('declare')">
              <i class="fas fa-gift"></i>
              <span>Declare Gift</span>
            </button>
            <button class="action-btn" onclick="navigateTo('review')">
              <i class="fas fa-gavel"></i>
              <span>Review Pending Gifts</span>
            </button>
            <button class="action-btn" onclick="navigateTo('users')">
              <i class="fas fa-user-plus"></i>
              <span>Appoint GDA/GAC</span>
            </button>
            <button class="action-btn" onclick="showAuditModal()">
              <i class="fas fa-file-contract"></i>
              <span>Annual Audit</span>
            </button>
          </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fas fa-user-check text-blue-500 text-xl mt-1"></i>
              </div>
              <div class="ml-4">
                <h3 class="text-lg font-medium text-gray-900">GDA/GAC Appointment</h3>
                <p class="mt-2 text-sm text-gray-600">
                  You have designated <strong>Kinley Wangchuk</strong> as GDA. 
                  <span id="gda-status" class="text-green-600">‚úì Active</span>
                </p>
                <div class="mt-4">
                  <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                          onclick="navigateTo('users')">
                    Manage Appointments
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow border-l-4 border-yellow-500">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fas fa-file-contract text-yellow-500 text-xl mt-1"></i>
              </div>
              <div class="ml-4">
                <h3 class="text-lg font-medium text-gray-900">Annual Audit Due</h3>
                <p class="mt-2 text-sm text-gray-600">
                  FY 2025‚Äì26 gift administration audit report (<strong>Rule 31</strong>) due to RAA by <strong>31 March 2026</strong>.
                </p>
                <div class="mt-4">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    <i class="fas fa-calendar mr-2"></i> Deadline: 2026-03-31
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow mt-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4"><i class="fas fa-history mr-2"></i> Recent Agency Declarations</h3>
          <ul class="space-y-4" id="recent-agency-declarations">
            <li class="flex">
              <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                <i class="fas fa-gift text-blue-600"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-medium">Nu. 12,000 cash gift ‚Äî Dorji Wangmo (ACC/FO/2018/001)</h4>
                <p class="text-sm text-gray-600">GDA reviewed. Awaiting your decision.</p>
                <p class="text-xs text-gray-500 mt-1"><span class="status-badge status-pending">Pending HoA Decision</span></p>
              </div>
            </li>
            <li class="flex">
              <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-4">
                <i class="fas fa-user-tie text-purple-600"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-medium">Gold pendant ‚Äî Your declaration (GDMS-2025-0998)</h4>
                <p class="text-sm text-gray-600">Forwarded to GDA for GAC review per Rule 21(a).</p>
                <p class="text-xs text-gray-500 mt-1"><span class="status-badge status-forwarded">Forwarded to GDA</span></p>
              </div>
            </li>
            <li class="flex">
              <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-4">
                <i class="fas fa-mobile-alt text-green-600"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-medium">Mobile phone ‚Äî Karma Dorji (ACC/IT/2020/003)</h4>
                <p class="text-sm text-gray-600">Awaiting market valuation report from GDA.</p>
                <p class="text-xs text-gray-500 mt-1"><span class="status-badge status-waiting">Awaiting Valuation</span></p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- DECLARE GIFT -->
    <div id="declare" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Declare a Gift</h2>
        <p class="text-gray-600">Submit within <strong>24 hours</strong> (Rule 13). <span class="text-red-600">Your gifts go to GDA for GAC review per Rule 21(a).</span></p>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="role-declaration-notice">
              <h4><i class="fas fa-info-circle"></i> Declaration as Head of Agency</h4>
              <p>Your declaration will be <strong>forwarded to GDA</strong> who will convene GAC for review per <strong>Rule 21(a)</strong>. You cannot review your own gifts.</p>
            </div>
            <div id="alert-container" class="mb-6"></div>
            <form id="gift-declaration-form">
              <div class="form-group">
                <label class="form-label">Date Gift Received <span class="text-red-600">*</span></label>
                <input type="date" class="form-control" id="gift-date" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Value (Nu.) <span class="text-red-600">*</span></label>
                  <input type="number" class="form-control" id="gift-value" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Category <span class="text-red-600">*</span></label>
                  <select class="form-control" id="gift-category" required>
                    <option value="">Select</option>
                    <option value="cash">Cash</option>
                    <option value="kind">In-kind</option>
                    <option value="service">Service/Favour</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="travel">Travel/Hospitality</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Description <span class="text-red-600">*</span></label>
                <textarea class="form-control" id="gift-description" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Upload Photos (Optional)</label>
                <div class="file-upload-container" id="file-upload-area">
                  <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                  <p class="font-medium text-gray-700">Drag & drop or click to browse</p>
                  <input type="file" id="gift-photos" accept="image/*" multiple style="display: none;">
                </div>
                <div class="file-preview" id="file-preview-container"></div>
              </div>
              <div class="form-group">
                <label class="form-label">Source/Donor <span class="text-red-600">*</span></label>
                <input type="text" class="form-control" id="gift-source" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Relationship <span class="text-red-600">*</span></label>
                  <select class="form-control" id="donor-relationship" required>
                    <option value="">Select</option>
                    <option value="family">Family Member</option>
                    <option value="friend">Friend</option>
                    <option value="business">Business Associate</option>
                    <option value="subordinate">Subordinate</option>
                    <option value="foreign">Foreign Entity</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Occasion</label>
                  <input type="text" class="form-control" id="gift-occasion">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Current Location/Handling</label>
                <textarea class="form-control" id="gift-location" rows="2" placeholder="Where is the gift currently kept?"></textarea>
              </div>
              <div class="form-group">
                <div class="flex items-center">
                  <input type="checkbox" id="prohibited-check" class="mr-2" required>
                  <label for="prohibited-check">I confirm this gift is not from a prohibited source (Rule 6)</label>
                </div>
              </div>
              <div class="flex justify-end space-x-3 mt-8">
                <button type="button" class="btn btn-secondary" onclick="navigateTo('dashboard')">
                  <i class="fas fa-times mr-2"></i> Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-paper-plane mr-2"></i> Submit to GDA
                </button>
              </div>
            </form>
          </div>
        </div>
        <div class="space-y-6">
          <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
            <h4 class="font-bold text-blue-800 mb-2"><i class="fas fa-info-circle mr-2"></i> Declaration Path for HoA</h4>
            <p class="text-sm text-blue-700">
              1. <strong>You declare gift</strong><br>
              2. <strong>Forwarded to GDA</strong><br>
              3. <strong>GDA convenes GAC</strong><br>
              4. <strong>GAC decides</strong><br>
              5. <strong>You recuse from review</strong>
            </p>
          </div>
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
            <h4 class="font-bold text-yellow-800 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i> Special Rules for HoA</h4>
            <p class="text-sm text-yellow-700">
              ‚Ä¢ <strong>Rule 21(a):</strong> HoA gifts go to GAC<br>
              ‚Ä¢ <strong>You cannot review</strong> own gifts<br>
              ‚Ä¢ <strong>GDA convenes</strong> GAC meeting<br>
              ‚Ä¢ <strong>14-day</strong> GAC review timeline
            </p>
          </div>
          <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
            <h4 class="font-bold text-green-800 mb-2"><i class="fas fa-clock mr-2"></i> Declaration Timeline</h4>
            <p class="text-sm text-green-700">
              ‚Ä¢ <strong>24 hours:</strong> Declare gift<br>
              ‚Ä¢ <strong>14 days:</strong> GAC must review<br>
              ‚Ä¢ <strong>30 days:</strong> Final decision due<br>
              ‚Ä¢ <strong>Annual:</strong> Audit report
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- MY GIFTS -->
    <div id="my-gifts" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">My Gift Declarations</h2>
        <p class="text-gray-600">Your declarations are reviewed by GAC per Rule 21(a). You cannot review your own gifts.</p>
      </div>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Ref No.</th>
                <th>Date</th>
                <th>Description</th>
                <th>Value</th>
                <th>Status</th>
                <th>Review Stage</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="my-gifts-table">
              <tr>
                <td>GDMS-2025-0998</td>
                <td>2025-12-20</td>
                <td>Gold pendant (family)</td>
                <td>Nu. 22,500</td>
                <td><span class="status-badge status-forwarded">Forwarded to GDA</span></td>
                <td>GDA will convene GAC</td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="viewGiftDetails('GDMS-2025-0998')">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
              </tr>
              <tr>
                <td>GDMS-2025-0851</td>
                <td>2025-11-05</td>
                <td>Dinner voucher (Nu. 5,200)</td>
                <td>Nu. 5,200</td>
                <td><span class="status-badge status-approved">GAC Approved</span></td>
                <td>Retained with conditions</td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="viewGiftDetails('GDMS-2025-0851')">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
              </tr>
              <tr>
                <td>GDMS-2025-0773</td>
                <td>2025-10-15</td>
                <td>Conference travel sponsorship</td>
                <td>Nu. 45,000</td>
                <td><span class="status-badge status-approved">GAC Approved</span></td>
                <td>Approved for retention</td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="viewGiftDetails('GDMS-2025-0773')">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
        <h4 class="font-bold text-blue-800 mb-2"><i class="fas fa-info-circle mr-2"></i> Note on HoA Gift Review</h4>
        <p class="text-sm text-blue-700">
          As Head of Agency, your gifts are reviewed by the Gift Administration Committee (GAC) per <strong>Rule 21(a)</strong>. 
          The GDA convenes the GAC meeting and you must recuse yourself from all discussions about your own gifts.
        </p>
      </div>
    </div>

    <!-- REVIEW -->
    <div id="review" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Review Declarations</h2>
        <p class="text-gray-600">Make final decisions on gifts reviewed by GDA (except your own gifts which go to GAC).</p>
      </div>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Ref No.</th>
                <th>Declarant</th>
                <th>Description</th>
                <th>Value</th>
                <th>GDA Recommendation</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="review-table">
              <tr>
                <td>GDMS-2025-1007</td>
                <td>Dorji Wangmo (ACC/FO/2018/001)</td>
                <td>Nu. 12,000 cash gift</td>
                <td>Nu. 12,000</td>
                <td><span class="status-badge status-pending">Approve with Conditions</span></td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="reviewGift('GDMS-2025-1007')">
                    <i class="fas fa-gavel"></i> Decide
                  </button>
                </td>
              </tr>
              <tr>
                <td>GDMS-2025-0999</td>
                <td>Karma Dorji (ACC/IT/2020/003)</td>
                <td>Mobile phone (Samsung Galaxy S24)</td>
                <td>Nu. 85,000</td>
                <td><span class="status-badge status-waiting">Awaiting Valuation</span></td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="reviewGift('GDMS-2025-0999')">
                    <i class="fas fa-gavel"></i> Decide
                  </button>
                </td>
              </tr>
              <tr>
                <td>GDMS-2025-0995</td>
                <td>Sonam Choden (GAC Member)</td>
                <td>Hotel stay (2 nights) during conference</td>
                <td>Nu. 18,000</td>
                <td><span class="status-badge status-pending">Approve Retention</span></td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="reviewGift('GDMS-2025-0995')">
                    <i class="fas fa-gavel"></i> Decide
                  </button>
                </td>
              </tr>
              <tr>
                <td>GDMS-2025-1001</td>
                <td>Kinley Wangchuk (GDA)</td>
                <td>Festival gift hamper</td>
                <td>Nu. 8,500</td>
                <td><span class="status-badge status-pending">Direct to HoA</span></td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="reviewGift('GDMS-2025-1001')">
                    <i class="fas fa-gavel"></i> Decide
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="mt-8">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Review Categories</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 class="font-bold text-blue-800 mb-2">Public Officials</h4>
            <p class="text-blue-700 text-sm">
              Gifts from public officials ‚Üí GDA reviews ‚Üí You decide
            </p>
            <div class="mt-2 text-blue-600">
              <i class="fas fa-users"></i> <span class="font-bold">4 pending</span>
            </div>
          </div>
          <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
            <h4 class="font-bold text-purple-800 mb-2">GDA & GAC Members</h4>
            <p class="text-purple-700 text-sm">
              Their gifts ‚Üí GDA forwards ‚Üí You decide directly
            </p>
            <div class="mt-2 text-purple-600">
              <i class="fas fa-user-tie"></i> <span class="font-bold">2 pending</span>
            </div>
          </div>
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <h4 class="font-bold text-green-800 mb-2">Your Gifts</h4>
            <p class="text-green-700 text-sm">
              Your gifts ‚Üí GDA ‚Üí GAC decides (You recuse)
            </p>
            <div class="mt-2 text-green-600">
              <i class="fas fa-user"></i> <span class="font-bold">1 with GDA</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- GIFT REGISTER -->
    <div id="register" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Agency Gift Register</h2>
        <p class="text-gray-600">Complete record of all gifts declared in your agency (Rule 17).</p>
      </div>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="p-4 border-b flex justify-between items-center">
          <div>
            <button class="btn btn-primary mr-2" onclick="exportRegister()">
              <i class="fas fa-download mr-2"></i> Export Register
            </button>
            <button class="btn btn-secondary" onclick="printRegister()">
              <i class="fas fa-print mr-2"></i> Print
            </button>
          </div>
          <div class="flex items-center space-x-2">
            <input type="text" class="form-control w-64" placeholder="Search register..." id="register-search">
            <select class="form-control w-48" id="register-filter">
              <option value="all">All Status</option>
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="returned">Returned</option>
              <option value="forfeited">Forfeited</option>
            </select>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Ref No.</th>
                <th>Declarant</th>
                <th>Date</th>
                <th>Description</th>
                <th>Value (Nu.)</th>
                <th>Disposition</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="register-table">
              <tr>
                <td>GDMS-2025-1007</td>
                <td>Dorji Wangmo (PO)</td>
                <td>2025-12-22</td>
                <td>Cash gift</td>
                <td>12,000</td>
                <td>Awaiting HoA decision</td>
                <td><span class="status-badge status-pending">Pending HoA</span></td>
              </tr>
              <tr>
                <td>GDMS-2025-0999</td>
                <td>Karma Dorji (PO)</td>
                <td>2025-12-18</td>
                <td>Mobile phone</td>
                <td>85,000</td>
                <td>Awaiting valuation</td>
                <td><span class="status-badge status-waiting">Valuation</span></td>
              </tr>
              <tr>
                <td>GDMS-2025-0998</td>
                <td>Pema Lhamo (HoA)</td>
                <td>2025-12-20</td>
                <td>Gold pendant</td>
                <td>22,500</td>
                <td>Forwarded to GDA for GAC</td>
                <td><span class="status-badge status-forwarded">With GDA</span></td>
              </tr>
              <tr>
                <td>GDMS-2025-0995</td>
                <td>Sonam Choden (GAC)</td>
                <td>2025-12-15</td>
                <td>Hotel accommodation</td>
                <td>18,000</td>
                <td>Forwarded to HoA by GDA</td>
                <td><span class="status-badge status-pending">Pending HoA</span></td>
              </tr>
              <tr>
                <td>GDMS-2025-1001</td>
                <td>Kinley Wangchuk (GDA)</td>
                <td>2025-12-10</td>
                <td>Festival hamper</td>
                <td>8,500</td>
                <td>Direct to HoA for decision</td>
                <td><span class="status-badge status-pending">Pending HoA</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="p-4 border-t text-center text-sm text-gray-600">
          Showing 5 of 47 records ‚Ä¢ Last updated: <span id="register-updated">2025-12-24 10:30 AM</span>
        </div>
      </div>
    </div>

    <!-- PENALTIES -->
    <div id="penalties" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Penalties & Compliance</h2>
        <p class="text-gray-600">Monitor late declarations, violations, and disciplinary actions (Rule 32).</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="stat-card">
          <p class="text-sm text-gray-500">Late Declarations This Month</p>
          <p class="text-3xl font-bold text-gray-900">2</p>
          <div class="mt-2 text-xs text-red-600">
            <i class="fas fa-clock mr-1"></i> Past 24-hour deadline
          </div>
        </div>
        <div class="stat-card">
          <p class="text-sm text-gray-500">Warning Letters Issued</p>
          <p class="text-3xl font-bold text-gray-900">3</p>
          <div class="mt-2 text-xs text-yellow-600">
            <i class="fas fa-exclamation-triangle mr-1"></i> First-stage penalties
          </div>
        </div>
        <div class="stat-card">
          <p class="text-sm text-gray-500">Disciplinary Cases</p>
          <p class="text-3xl font-bold text-gray-900">1</p>
          <div class="mt-2 text-xs text-red-600">
            <i class="fas fa-gavel mr-1"></i> Under investigation
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Violation</th>
                <th>Date</th>
                <th>Action Taken</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Yeshey Dorji (ACC/HR/2015/008)</td>
                <td>Late declaration (48 hours)</td>
                <td>2025-12-10</td>
                <td>Written warning issued</td>
                <td><span class="status-badge status-active">Active</span></td>
              </tr>
              <tr>
                <td>Tashi Wangchuk (ACC/FA/2019/012)</td>
                <td>Non-declaration of Nu. 8,500 gift</td>
                <td>2025-11-28</td>
                <td>Disciplinary proceedings initiated</td>
                <td><span class="status-badge status-pending">Under Review</span></td>
              </tr>
              <tr>
                <td>Chimi Dema (ACC/PR/2021/005)</td>
                <td>Incomplete declaration details</td>
                <td>2025-12-05</td>
                <td>Returned for correction</td>
                <td><span class="status-badge status-approved">Resolved</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="mt-8 bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
        <h4 class="font-bold text-blue-800 mb-2"><i class="fas fa-info-circle mr-2"></i> HoA Responsibilities (Rule 32)</h4>
        <p class="text-sm text-blue-700">
          As Head of Agency, you must ensure timely disciplinary action for violations. 
          Penalties range from written warnings to dismissal depending on severity. 
          All actions must be recorded and reported in the annual audit.
        </p>
      </div>
    </div>

    <!-- KNOWLEDGE BASE -->
    <div id="knowledge" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Guidance & Knowledge Base</h2>
        <p class="text-gray-600">Rules, procedures, and templates for gift administration.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg shadow p-6">
          <div class="text-blue-600 text-3xl mb-4">
            <i class="fas fa-book"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Rules & Regulations</h3>
          <p class="text-gray-600 mb-4">Complete text of the Gift Rules 2022 with official commentary.</p>
          <button class="btn btn-primary" onclick="downloadResource('rules')">
            <i class="fas fa-download mr-2"></i> Download PDF
          </button>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
          <div class="text-green-600 text-3xl mb-4">
            <i class="fas fa-file-alt"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Forms & Templates</h3>
          <p class="text-gray-600 mb-4">Official templates for declarations, meeting minutes, and reports.</p>
          <button class="btn btn-primary" onclick="downloadResource('templates')">
            <i class="fas fa-download mr-2"></i> Access Templates
          </button>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
          <div class="text-purple-600 text-3xl mb-4">
            <i class="fas fa-question-circle"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">FAQs & Guidance</h3>
          <p class="text-gray-600 mb-4">Common questions and interpretive guidance on gift rules.</p>
          <button class="btn btn-primary" onclick="showFAQs()">
            <i class="fas fa-external-link-alt mr-2"></i> View FAQs
          </button>
        </div>
      </div>
      <div class="mt-8 bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">HoA-Specific Guidance</h3>
        <div class="space-y-4">
          <div class="border-l-4 border-blue-500 pl-4 py-2">
            <h4 class="font-bold text-gray-900">Rule 19: Designation of GDA & GAC</h4>
            <p class="text-gray-600 text-sm">As Head of Agency, you must designate a Gift Declaration Administrator and establish a Gift Administration Committee.</p>
            <button class="btn btn-primary btn-sm mt-2" onclick="showRuleDetails('Rule 19')">View Details</button>
          </div>
          <div class="border-l-4 border-green-500 pl-4 py-2">
            <h4 class="font-bold text-gray-900">Rule 21: GAC Review of HoA Gifts</h4>
            <p class="text-gray-600 text-sm">All gifts received by the HoA must be reviewed by the Committee. The HoA must recuse from discussions of their own gifts.</p>
            <button class="btn btn-primary btn-sm mt-2" onclick="showRuleDetails('Rule 21')">View Details</button>
          </div>
          <div class="border-l-4 border-yellow-500 pl-4 py-2">
            <h4 class="font-bold text-gray-900">Rule 31: Annual Audit Report</h4>
            <p class="text-gray-600 text-sm">HoA must submit an annual gift administration audit report to the Royal Audit Authority by March 31 each year.</p>
            <button class="btn btn-primary btn-sm mt-2" onclick="showRuleDetails('Rule 31')">View Details</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MANAGE USERS -->
    <div id="users" class="page">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Appoint GDA & GAC Members</h2>
        <p class="text-gray-600">Designate Gift Declaration Administrator and Gift Administration Committee per Rule 19.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4"><i class="fas fa-user-tie text-blue-600 mr-2"></i> Current GDA</h3>
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
              <i class="fas fa-user-shield text-blue-600"></i>
            </div>
            <div>
              <h4 class="font-bold text-gray-900">Kinley Wangchuk</h4>
              <p class="text-sm text-gray-600">Deputy Commissioner ‚Ä¢ ACC/DC/2010/123</p>
              <p class="text-xs text-green-600 mt-1"><i class="fas fa-check-circle"></i> Active since 2024-01-15</p>
            </div>
          </div>
          <div class="mt-4">
            <button class="btn btn-primary w-full" onclick="appointGDA()">
              <i class="fas fa-user-edit mr-2"></i> Appoint/Change GDA
            </button>
          </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4"><i class="fas fa-users text-green-600 mr-2"></i> GAC Members</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3">
                  <span class="text-green-600 font-bold">1</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Sonam Choden</p>
                  <p class="text-xs text-gray-600">Director, Legal</p>
                </div>
              </div>
              <span class="text-green-600 text-sm"><i class="fas fa-check"></i> Active</span>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3">
                  <span class="text-green-600 font-bold">2</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Dorji Wangmo</p>
                  <p class="text-xs text-gray-600">Director, Finance</p>
                </div>
              </div>
              <span class="text-green-600 text-sm"><i class="fas fa-check"></i> Active</span>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3">
                  <span class="text-green-600 font-bold">3</span>
                </div>
                <div>
                  <p class="font-medium text-gray-900">Karma Dorji</p>
                  <p class="text-xs text-gray-600">Director, Admin</p>
                </div>
              </div>
              <span class="text-green-600 text-sm"><i class="fas fa-check"></i> Active</span>
            </div>
          </div>
          <div class="mt-4">
            <button class="btn btn-primary w-full" onclick="manageGAC()">
              <i class="fas fa-user-plus mr-2"></i> Manage GAC Members
            </button>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-lg shadow">
        <div class="p-4 border-b">
          <h3 class="text-lg font-bold text-gray-900">Rule 19 Requirements</h3>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <div class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <i class="fas fa-check-circle text-green-500"></i>
              </div>
              <div class="ml-3">
                <p class="font-medium text-gray-900">GDA Qualification</p>
                <p class="text-sm text-gray-600">Must be at least Deputy Secretary level or equivalent</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <i class="fas fa-check-circle text-green-500"></i>
              </div>
              <div class="ml-3">
                <p class="font-medium text-gray-900">GAC Composition</p>
                <p class="text-sm text-gray-600">Minimum 3 members, all senior officers</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <i class="fas fa-check-circle text-green-500"></i>
              </div>
              <div class="ml-3">
                <p class="font-medium text-gray-900">Formal Appointment</p>
                <p class="text-sm text-gray-600">All appointments must be in writing</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <i class="fas fa-check-circle text-green-500"></i>
              </div>
              <div class="ml-3">
                <p class="font-medium text-gray-900">Notification</p>
                <p class="text-sm text-gray-600">GDA appointment must be notified to ACC</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- MODALS -->
  <div id="modal-container" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title"></h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer" id="modal-footer"></div>
    </div>
  </div>

  <!-- CONNECTION STATUS -->
  <div id="connection-status">
    <i class="fas fa-wifi"></i>
    <span>Online</span>
  </div>

  <script>
  // Global Variables
  let currentUser = null;
  let uploadedFiles = [];
  let currentModal = null;

  // DOM Content Loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize the dashboard
    initDashboard();
    
    // Set up event listeners
    setupEventListeners();
    
    // Show the interface
    setTimeout(() => {
      document.getElementById('loading-screen').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('user-info-bar').style.display = 'flex';
        document.getElementById('main-header').style.display = 'block';
        document.getElementById('main-navigation').style.display = 'block';
        document.getElementById('main-content').style.display = 'block';
        
        // Set default date to today
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('gift-date');
        if (dateInput) dateInput.value = today;
      }, 500);
    }, 1000);
  });

  // Initialize Dashboard
  function initDashboard() {
    // Get user data from localStorage or global variable
    const userData = window.realUserData || JSON.parse(localStorage.getItem('gdms_user') || '{}');
    currentUser = userData;
    
    // Update user info
    updateUserInfo(userData);
    
    // Load dashboard data
    loadDashboardData();
  }

  // Update User Information
  function updateUserInfo(user) {
    const name = user.name || 'Pema Lhamo';
    const agency = user.agency || 'Anti-Corruption Commission';
    const role = user.role || 'hoa';
    
    // Update all name displays
    document.getElementById('user-name').textContent = name;
    document.getElementById('header-user-name').textContent = name;
    document.getElementById('hoa-agency-name').textContent = agency;
    document.getElementById('user-agency').textContent = agency;
    
    // Update avatar initials
    const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
    document.getElementById('user-avatar').textContent = initials;
    document.getElementById('header-avatar').textContent = initials;
  }

  // Load Dashboard Data
  function loadDashboardData() {
    // Simulate API call for dashboard statistics
    setTimeout(() => {
      // These would typically come from an API
      const stats = {
        personalDeclarations: 3,
        pendingDecisions: 8,
        complianceRate: 92,
        activeUsers: 47,
        gdaActive: true
      };
      
      document.getElementById('hoa-personal-declarations').textContent = stats.personalDeclarations;
      document.getElementById('hoa-pending-decisions').textContent = stats.pendingDecisions;
      document.getElementById('hoa-compliance-rate').textContent = stats.complianceRate + '%';
      document.getElementById('hoa-compliance-bar').style.width = stats.complianceRate + '%';
      document.getElementById('hoa-new-users').textContent = stats.activeUsers;
      
      // Update GDA status
      const gdaStatus = document.getElementById('gda-status');
      if (gdaStatus) {
        gdaStatus.textContent = stats.gdaActive ? '‚úì Active' : '‚úó Not Designated';
        gdaStatus.className = stats.gdaActive ? 'text-green-600' : 'text-red-600';
      }
      
      // Update register timestamp
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      document.getElementById('register-updated').textContent = 
        now.toISOString().split('T')[0] + ' ' + timeStr;
    }, 500);
  }

  // Set Up Event Listeners
  function setupEventListeners() {
    // Navigation tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function(e) {
        e.preventDefault();
        const page = this.dataset.page;
        navigateTo(page);
      });
    });
    
    // Logout button
    document.getElementById('logout-button').addEventListener('click', logout);
    
    // Gift declaration form
    const giftForm = document.getElementById('gift-declaration-form');
    if (giftForm) {
      giftForm.addEventListener('submit', handleGiftDeclaration);
    }
    
    // File upload
    const fileUpload = document.getElementById('file-upload-area');
    const fileInput = document.getElementById('gift-photos');
    
    if (fileUpload && fileInput) {
      fileUpload.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', handleFileSelect);
      
      // Drag and drop
      fileUpload.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUpload.classList.add('dragover');
      });
      
      fileUpload.addEventListener('dragleave', () => {
        fileUpload.classList.remove('dragover');
      });
      
      fileUpload.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUpload.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFileSelect({ target: fileInput });
        }
      });
    }
    
    // Register search and filter
    const registerSearch = document.getElementById('register-search');
    const registerFilter = document.getElementById('register-filter');
    
    if (registerSearch) {
      registerSearch.addEventListener('input', filterRegister);
    }
    
    if (registerFilter) {
      registerFilter.addEventListener('change', filterRegister);
    }
  }

  // Navigation Function
  function navigateTo(pageId) {
    // Update active tab
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.classList.remove('active');
      tab.classList.remove('border-blue-600', 'text-gray-900');
      tab.classList.add('border-transparent');
    });
    
    const activeTab = document.querySelector(`.nav-tab[data-page="${pageId}"]`);
    if (activeTab) {
      activeTab.classList.add('active', 'border-blue-600', 'text-gray-900');
      activeTab.classList.remove('border-transparent');
    }
    
    // Update active page
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
      targetPage.classList.add('active');
      window.scrollTo(0, 0);
    }
  }

  // Handle Gift Declaration
  function handleGiftDeclaration(e) {
    e.preventDefault();
    
    // Get form values
    const giftValue = parseFloat(document.getElementById('gift-value').value);
    const giftDate = document.getElementById('gift-date').value;
    const giftDescription = document.getElementById('gift-description').value;
    const giftSource = document.getElementById('gift-source').value;
    
    // Validation
    if (!giftDate) {
      showAlert('error', 'Please select the date the gift was received.');
      return;
    }
    
    if (!giftValue || giftValue <= 0) {
      showAlert('error', 'Please enter a valid gift value.');
      return;
    }
    
    if (!giftDescription.trim()) {
      showAlert('error', 'Please provide a description of the gift.');
      return;
    }
    
    if (!giftSource.trim()) {
      showAlert('error', 'Please provide the source/donor information.');
      return;
    }
    
    if (!document.getElementById('prohibited-check').checked) {
      showAlert('error', 'You must confirm the gift is not from a prohibited source.');
      return;
    }
    
    // Show success message
    showAlert('success', 'Gift declaration submitted successfully! Forwarded to GDA for GAC review per Rule 21(a).');
    
    // Reset form
    e.target.reset();
    uploadedFiles = [];
    document.getElementById('file-preview-container').innerHTML = '';
    
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('gift-date').value = today;
    
    // Update dashboard count
    const currentCount = parseInt(document.getElementById('hoa-personal-declarations').textContent);
    document.getElementById('hoa-personal-declarations').textContent = currentCount + 1;
    
    // Navigate to my gifts
    setTimeout(() => navigateTo('my-gifts'), 2000);
  }

  // Handle File Selection
  function handleFileSelect(e) {
    const files = Array.from(e.target.files);
    const previewContainer = document.getElementById('file-preview-container');
    
    files.forEach(file => {
      if (!file.type.startsWith('image/')) {
        showAlert('error', 'Only image files are allowed.');
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) { // 5MB limit
        showAlert('error', 'File size must be less than 5MB.');
        return;
      }
      
      uploadedFiles.push(file);
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const previewItem = document.createElement('div');
        previewItem.className = 'file-preview-item';
        previewItem.innerHTML = `
          <img src="${e.target.result}" alt="${file.name}">
          <button type="button" class="remove-file" onclick="removeFile('${file.name}')">&times;</button>
        `;
        previewContainer.appendChild(previewItem);
      };
      reader.readAsDataURL(file);
    });
  }

  // Remove File
  function removeFile(fileName) {
    uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
    const previewContainer = document.getElementById('file-preview-container');
    previewContainer.innerHTML = '';
    uploadedFiles.forEach(file => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const previewItem = document.createElement('div');
        previewItem.className = 'file-preview-item';
        previewItem.innerHTML = `
          <img src="${e.target.result}" alt="${file.name}">
          <button type="button" class="remove-file" onclick="removeFile('${file.name}')">&times;</button>
        `;
        previewContainer.appendChild(previewItem);
      };
      reader.readAsDataURL(file);
    });
  }

  // Show Alert
  function showAlert(type, message) {
    const container = document.getElementById('alert-container') || document.body;
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'}"></i>
      <span>${message}</span>
    `;
    
    if (container.id === 'alert-container') {
      container.appendChild(alert);
    } else {
      // Create a temporary container at the top
      alert.style.position = 'fixed';
      alert.style.top = '20px';
      alert.style.left = '50%';
      alert.style.transform = 'translateX(-50%)';
      alert.style.zIndex = '10000';
      alert.style.minWidth = '300px';
      document.body.appendChild(alert);
    }
    
    setTimeout(() => alert.remove(), 5000);
  }

  // Modal Functions
  function showModal(title, content, footer = '') {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-body').innerHTML = content;
    document.getElementById('modal-footer').innerHTML = footer;
    document.getElementById('modal-container').classList.add('active');
    currentModal = { title, content, footer };
  }

  function closeModal() {
    document.getElementById('modal-container').classList.remove('active');
    currentModal = null;
  }

  // View Gift Details
  function viewGiftDetails(refNo) {
    const giftData = {
      'GDMS-2025-0998': {
        description: 'Gold pendant from family member',
        value: 'Nu. 22,500',
        date: '2025-12-20',
        source: 'Family member (sibling)',
        status: 'Forwarded to GDA',
        notes: 'Gift received during family ceremony. Forwarded to GDA for GAC review per Rule 21(a). You cannot review this gift.',
        path: 'HoA ‚Üí GDA ‚Üí GAC (You recuse)'
      },
      'GDMS-2025-0851': {
        description: 'Dinner voucher from business associate',
        value: 'Nu. 5,200',
        date: '2025-11-05',
        source: 'Business associate (non-prohibited)',
        status: 'GAC Approved',
        notes: 'Approved by GAC for retention with conditions. You recused from discussion.',
        path: 'HoA ‚Üí GDA ‚Üí GAC ‚Üí Approved'
      }
    };
    
    const gift = giftData[refNo] || {
      description: 'Gift details not found',
      value: 'N/A',
      date: 'N/A',
      source: 'N/A',
      status: 'Unknown',
      notes: 'No additional information available.',
      path: 'Unknown'
    };
    
    const content = `
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="form-label">Reference Number</label>
            <div class="font-bold">${refNo}</div>
          </div>
          <div>
            <label class="form-label">Date Declared</label>
            <div>${gift.date}</div>
          </div>
          <div>
            <label class="form-label">Description</label>
            <div>${gift.description}</div>
          </div>
          <div>
            <label class="form-label">Value</label>
            <div>${gift.value}</div>
          </div>
          <div>
            <label class="form-label">Source/Donor</label>
            <div>${gift.source}</div>
          </div>
          <div>
            <label class="form-label">Status</label>
            <div>${gift.status}</div>
          </div>
          <div class="col-span-2">
            <label class="form-label">Review Path</label>
            <div class="text-blue-600 font-medium">${gift.path}</div>
          </div>
        </div>
        <div>
          <label class="form-label">Notes</label>
          <div class="bg-gray-50 p-3 rounded">${gift.notes}</div>
        </div>
      </div>
    `;
    
    showModal(`Gift Details: ${refNo}`, content, `
      <button class="btn btn-secondary" onclick="closeModal()">Close</button>
    `);
  }

  // Review Gift
  function reviewGift(refNo) {
    const giftData = {
      'GDMS-2025-1007': {
        declarant: 'Dorji Wangmo (Public Official)',
        recommendation: 'Approve with Conditions'
      },
      'GDMS-2025-0999': {
        declarant: 'Karma Dorji (Public Official)', 
        recommendation: 'Awaiting Valuation'
      },
      'GDMS-2025-0995': {
        declarant: 'Sonam Choden (GAC Member)',
        recommendation: 'Approve Retention'
      },
      'GDMS-2025-1001': {
        declarant: 'Kinley Wangchuk (GDA)',
        recommendation: 'Direct to HoA'
      }
    };
    
    const gift = giftData[refNo] || {
      declarant: 'Unknown',
      recommendation: 'No recommendation'
    };
    
    const content = `
      <div class="space-y-4">
        <div class="bg-blue-50 p-4 rounded">
          <h4 class="font-bold text-blue-900">${refNo}</h4>
          <p class="text-blue-800">Declarant: ${gift.declarant}</p>
          <p class="text-blue-800">GDA Recommendation: <strong>${gift.recommendation}</strong></p>
        </div>
        <div>
          <label class="form-label">Your Decision</label>
          <select class="form-control" id="review-decision">
            <option value="">Select decision</option>
            <option value="approve">Approve Retention</option>
            <option value="approve-conditions">Approve with Conditions</option>
            <option value="forfeit">Forfeit to State</option>
            <option value="return">Return to Donor</option>
            <option value="request-info">Request More Information</option>
          </select>
        </div>
        <div>
          <label class="form-label">Comments</label>
          <textarea class="form-control" id="review-comments" rows="3" placeholder="Add comments for your decision..."></textarea>
        </div>
        <div>
          <label class="form-label">Rule Citation</label>
          <input type="text" class="form-control" id="review-rule" placeholder="e.g., Rule 12(3)">
        </div>
      </div>
    `;
    
    const footer = `
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitReview('${refNo}')">Submit Decision</button>
    `;
    
    showModal('Review Gift Declaration', content, footer);
  }

  function submitReview(refNo) {
    const decision = document.getElementById('review-decision').value;
    if (!decision) {
      showAlert('error', 'Please select a decision.');
      return;
    }
    
    showAlert('success', `Decision submitted for ${refNo}. GDA will be notified to implement.`);
    closeModal();
    
    // Update pending decisions count
    const current = parseInt(document.getElementById('hoa-pending-decisions').textContent);
    if (current > 0) {
      document.getElementById('hoa-pending-decisions').textContent = current - 1;
    }
  }

  // Show Audit Modal
  function showAuditModal() {
    const content = `
      <div class="space-y-4">
        <div class="bg-yellow-50 p-4 rounded">
          <h4 class="font-bold text-yellow-900"><i class="fas fa-exclamation-triangle mr-2"></i> Annual Audit Report Due</h4>
          <p class="text-yellow-800">Rule 31 requires HoA to submit annual gift administration audit report to RAA by March 31 each year.</p>
        </div>
        <div>
          <label class="form-label">Fiscal Year</label>
          <select class="form-control" id="audit-year">
            <option>2025-2026</option>
            <option>2024-2025</option>
            <option>2023-2024</option>
          </select>
        </div>
        <div>
          <label class="form-label">Report Period</label>
          <div class="flex space-x-2">
            <input type="date" class="form-control" id="audit-start" value="2025-04-01">
            <span class="self-center">to</span>
            <input type="date" class="form-control" id="audit-end" value="2026-03-31">
          </div>
        </div>
        <div>
          <label class="form-label">Upload Audit Report</label>
          <div class="file-upload-container" onclick="document.getElementById('audit-file').click()">
            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
            <p class="font-medium text-gray-700">Click to upload PDF report</p>
            <input type="file" id="audit-file" accept=".pdf" style="display: none;">
          </div>
        </div>
      </div>
    `;
    
    const footer = `
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitAudit()">
        <i class="fas fa-paper-plane mr-2"></i> Submit to RAA
      </button>
    `;
    
    showModal('Annual Audit Report (Rule 31)', content, footer);
  }

  function submitAudit() {
    showAlert('success', 'Annual audit report submitted successfully to RAA.');
    closeModal();
  }

  // Export Register
  function exportRegister() {
    showAlert('success', 'Gift register exported successfully. Download will begin shortly.');
  }

  // Print Register
  function printRegister() {
    window.print();
  }

  // Filter Register
  function filterRegister() {
    const search = document.getElementById('register-search').value.toLowerCase();
    const filter = document.getElementById('register-filter').value;
    
    const rows = document.querySelectorAll('#register-table tr');
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      const status = row.querySelector('.status-badge').textContent.toLowerCase();
      
      const matchesSearch = text.includes(search);
      const matchesFilter = filter === 'all' || status.includes(filter);
      
      row.style.display = matchesSearch && matchesFilter ? '' : 'none';
    });
  }

  // Download Resource
  function downloadResource(type) {
    const resources = {
      rules: 'Gift_Rules_2022.pdf',
      templates: 'GDMS_Templates.zip',
      faqs: 'GDMS_FAQs.pdf'
    };
    
    showAlert('success', `Downloading ${resources[type]}...`);
  }

  // Show FAQs
  function showFAQs() {
    const content = `
      <div class="space-y-4">
        <div>
          <h4 class="font-bold text-gray-900 mb-2">Q: What gifts must be declared?</h4>
          <p class="text-gray-600">All gifts exceeding Nu. 5,000 in value, or any gift regardless of value if from a prohibited source, must be declared within 24 hours.</p>
        </div>
        <div>
          <h4 class="font-bold text-gray-900 mb-2">Q: Who reviews HoA gifts?</h4>
          <p class="text-gray-600">HoA gifts go to GDA ‚Üí GDA convenes GAC ‚Üí GAC decides. HoA must recuse from all discussions about their own gifts (Rule 21a).</p>
        </div>
        <div>
          <h4 class="font-bold text-gray-900 mb-2">Q: Who appoints GDA and GAC?</h4>
          <p class="text-gray-600">Only HoA appoints GDA and GAC members per Rule 19. Public officials self-register automatically.</p>
        </div>
      </div>
    `;
    
    showModal('Frequently Asked Questions', content, `
      <button class="btn btn-secondary" onclick="closeModal()">Close</button>
      <button class="btn btn-primary" onclick="downloadResource('faqs')">
        <i class="fas fa-download mr-2"></i> Download Full FAQs
      </button>
    `);
  }

  // Show Rule Details
  function showRuleDetails(rule) {
    const rules = {
      'Rule 19': {
        title: 'Designation of GDA and Constitution of GAC',
        content: 'The Head of Agency shall designate a Gift Declaration Administrator and constitute a Gift Administration Committee within 30 days of assuming office.',
        requirements: [
          'GDA must be at least Deputy Secretary level',
          'GAC must have minimum 3 members',
          'GAC members must be senior officers',
          'Designations must be in writing',
          'GDA appointment must be notified to ACC'
        ]
      },
      'Rule 21': {
        title: 'Review by Gift Administration Committee',
        content: 'All gifts received by the Head of Agency, GDA, or GAC members shall be reviewed by the Gift Administration Committee.',
        requirements: [
          'HoA gifts: HoA ‚Üí GDA ‚Üí GAC (HoA recuses)',
          'GDA gifts: GDA ‚Üí HoA decides directly',
          'GAC gifts: GAC ‚Üí GDA ‚Üí HoA decides',
          'Public official gifts: GDA ‚Üí HoA decides',
          'Committee must meet within 14 days'
        ]
      },
      'Rule 31': {
        title: 'Annual Audit Report',
        content: 'The Head of Agency shall submit an annual gift administration audit report to the Royal Audit Authority by March 31 each year.',
        requirements: [
          'Report must cover entire fiscal year',
          'Must include all gift transactions',
          'Must note any violations and actions',
          'Must be signed by HoA',
          'Deadline: March 31 annually'
        ]
      }
    };
    
    const ruleData = rules[rule];
    const content = `
      <div class="space-y-4">
        <div class="bg-blue-50 p-4 rounded">
          <h4 class="font-bold text-blue-900 mb-2">${rule}: ${ruleData.title}</h4>
          <p class="text-blue-800">${ruleData.content}</p>
        </div>
        <div>
          <h5 class="font-bold text-gray-900 mb-2">Requirements & Flow:</h5>
          <ul class="list-disc pl-5 space-y-1">
            ${ruleData.requirements.map(req => `<li class="text-gray-600">${req}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
    
    showModal(`Rule Details: ${rule}`, content, `
      <button class="btn btn-secondary" onclick="closeModal()">Close</button>
    `);
  }

  // Appoint GDA
  function appointGDA() {
    const content = `
      <div class="space-y-4">
        <div>
          <label class="form-label">Select GDA</label>
          <select class="form-control" id="gda-select">
            <option value="">Select officer</option>
            <option value="ACC/DC/2010/123" selected>Kinley Wangchuk - Deputy Commissioner</option>
            <option value="ACC/DL/2015/456">Sonam Choden - Director, Legal</option>
            <option value="ACC/DF/2018/789">Dorji Wangmo - Director, Finance</option>
            <option value="ACC/DA/2020/012">Karma Dorji - Director, Administration</option>
          </select>
        </div>
        <div>
          <label class="form-label">Effective Date</label>
          <input type="date" class="form-control" id="gda-date" value="${new Date().toISOString().split('T')[0]}">
        </div>
        <div>
          <label class="form-label">Appointment Order No.</label>
          <input type="text" class="form-control" id="gda-order" placeholder="e.g., ACC/Order/2025/001">
        </div>
        <div class="bg-blue-50 p-3 rounded text-sm">
          <i class="fas fa-info-circle text-blue-600 mr-2"></i>
          GDA must be at least Deputy Secretary level. Appointment must be notified to ACC.
        </div>
      </div>
    `;
    
    const footer = `
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitGDA()">Appoint GDA</button>
    `;
    
    showModal('Appoint Gift Declaration Administrator', content, footer);
  }

  function submitGDA() {
    const gda = document.getElementById('gda-select').value;
    if (!gda) {
      showAlert('error', 'Please select a GDA.');
      return;
    }
    
    showAlert('success', 'GDA appointed successfully. Notification sent to ACC.');
    closeModal();
    
    // Update GDA status
    document.getElementById('gda-status').textContent = '‚úì Active';
    document.getElementById('gda-status').className = 'text-green-600';
  }

  // Manage GAC Members
  function manageGAC() {
    const content = `
      <div class="space-y-4">
        <div>
          <label class="form-label">Add GAC Member</label>
          <select class="form-control" id="gac-select">
            <option value="">Select officer</option>
            <option value="ACC/DL/2015/456">Sonam Choden - Director, Legal</option>
            <option value="ACC/DF/2018/789">Dorji Wangmo - Director, Finance</option>
            <option value="ACC/DA/2020/012">Karma Dorji - Director, Administration</option>
            <option value="ACC/DP/2017/345">Tenzin Wangchuk - Director, Planning</option>
          </select>
        </div>
        <div class="bg-yellow-50 p-3 rounded text-sm">
          <i class="fas fa-info-circle text-yellow-600 mr-2"></i>
          GAC must have minimum 3 members, all senior officers. Members serve for 2-year term.
        </div>
        <div>
          <h5 class="font-bold text-gray-900 mb-2">Current GAC Members</h5>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
              <span>Sonam Choden (Director, Legal)</span>
              <button class="text-red-600 hover:text-red-800" onclick="removeGAC('ACC/DL/2015/456')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
              <span>Dorji Wangmo (Director, Finance)</span>
              <button class="text-red-600 hover:text-red-800" onclick="removeGAC('ACC/DF/2018/789')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
              <span>Karma Dorji (Director, Administration)</span>
              <button class="text-red-600 hover:text-red-800" onclick="removeGAC('ACC/DA/2020/012')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
    
    const footer = `
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addGAC()">Add Member</button>
    `;
    
    showModal('Manage GAC Members', content, footer);
  }

  function addGAC() {
    const member = document.getElementById('gac-select').value;
    if (!member) {
      showAlert('error', 'Please select a GAC member.');
      return;
    }
    
    showAlert('success', 'GAC member added successfully.');
    closeModal();
  }

  function removeGAC(memberId) {
    if (confirm('Remove this GAC member?')) {
      showAlert('info', 'GAC member removed.');
    }
  }

  // Logout Function
  function logout() {
    if (confirm('Are you sure you want to logout?')) {
      // Clear authentication data
      localStorage.removeItem('gdms_user');
      localStorage.removeItem('gdms_token');
      sessionStorage.removeItem('gdms_session');
      
      // Redirect to login
      window.location.href = 'login.html';
    }
  }

  // Simulate Connection Status
  setInterval(() => {
    const status = document.getElementById('connection-status');
    if (Math.random() > 0.1) {
      status.innerHTML = '<i class="fas fa-wifi"></i><span>Online</span>';
      status.style.background = '#d4edda';
      status.style.color = '#155724';
      status.style.borderColor = '#c3e6cb';
    } else {
      status.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Connection Issues</span>';
      status.style.background = '#fff3cd';
      status.style.color = '#856404';
      status.style.borderColor = '#ffeaa7';
    }
  }, 10000);
  </script>
</body>
</html>